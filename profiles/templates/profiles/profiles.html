{% extends "base.html" %}
{% load static %}

{% block page_header %}
<div class="container header-container">
    <div class="row">
        <div class="col"></div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="overlay"></div>
<div class="card mb-2">
    <div class="row">
        <div class="col">
            <hr>
            <h2 class="logo-font text-center mb-2">Profile</h2>
            <hr>
        </div>
    </div>

    {% if messages %}
    <div class="row">
        <div class="col">
            <div class="alert alert-success bg-dark text-white">
                <ul>
                    {% for message in messages %}
                    <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row text-white">
        <div class="col">
            <form method="post" class="text-white">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn float-right p-1">Update</button>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <hr>
            <h3 class="logo-font text-center mb-2">Order History</h3>
            <hr>
            <div class="table-responsive rounded-10 text-white">
                <table class="table text-white">
                    <thead>
                        <tr>
                            <th>Order Number</th>
                            <th>Date</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr>
                            <td>{{ order.order_number }}</td>
                            <td>{{ order.date }}</td>
                            <td>
                                <a class="text-light p-1" href="javascript:void(0);" data-order-id="{{ order.id }}">View</a>                            
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3">No orders yet.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="orderDetails" style="display:none;">
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('a[data-order-id]').forEach(element => {
            element.addEventListener('click', function(event) {
                event.preventDefault();

                var orderId = this.getAttribute('data-order-id');
                fetchOrderDetails(orderId);
            });
        });
    });

    function fetchOrderDetails(orderId) {
        fetch(`/profile/order/${orderId}/`)
            .then(response => response.json())
            .then(data => {
                const orderDetailsDiv = document.getElementById('orderDetails');
                orderDetailsDiv.innerHTML = data; 
                orderDetailsDiv.style.display = 'block';
            })
            .catch(error => console.error('Error:', error));
    }
</script>


{% endblock %}
